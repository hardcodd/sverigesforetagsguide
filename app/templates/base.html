{% load i18n wagtailcore_tags wagtailuserbar core %}
{% load render_bundle from webpack_loader %}

{% get_current_language as lang %}

<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    <meta charset="utf-8" />
    <title>
      {% block title %}
        {% if page.seo_title %}
          {{ page.seo_title }}
        {% else %}
          {{ page.title|clear }}
        {% endif %}
      {% endblock %}
      {% block title_suffix %}
        {% wagtail_site as current_site %}
        {% if current_site and current_site.site_name %}â€” {{ current_site.site_name }}{% endif %}
      {% endblock %}
    </title>
    {% if page.search_description %}<meta name="description" content="{{ page.search_description }}" />{% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {% if page.noindex %}<meta name="robots" content="noindex">{% endif %}

    {% if page %}
      <!-- canonical -->
      <link rel="canonical" href="{% fullpageurl page %}">
      <meta property="og:url" content="{% fullpageurl page %}" />
    {% endif %}

    {% block extrahead %}{% endblock %}

    {% include "includes/favicon.html" %}

    {# Force all links in the live preview panel to be opened in a new tab #}
    {% if request.in_preview_panel %}<base target="_blank">{% endif %}

    {# Global stylesheets #}
    {% render_bundle 'main' 'css' %}

    {% block extra_css %}{% endblock %}

    {% jsonld %}

    {% include "includes/external_code.html" with place="head" %}
  </head>

  <body class="{% block body_class %} {% endblock %}">
    {% wagtailuserbar %}
    {% include "includes/external_code.html" with place="body" %}

    <div id="page" class="page">
      {% include "includes/header.html" %}

      <main id="main" class="main">
        <div class="container">{% include "includes/breadcrumbs.html" %}</div>
        {% block content %}{% endblock %}
      </main>

      {% include "includes/footer.html" %}
    </div>

    {% if request.user.is_staff or request.user.is_superuser %}<div class="check-links-btn">Check links</div>{% endif %}

    {# Global javascript #}
    {% if "localhost" in request.build_absolute_uri or "127.0.0.1" in request.build_absolute_uri %}
      <script>window.NG_COOKIE_DOMAIN = "localhost";</script>
    {% else %}
      <script>window.NG_COOKIE_DOMAIN = ".{{ request.build_absolute_uri|website_name }}";</script>
    {% endif %}

    <script src="{% url 'javascript-catalog' %}"></script>
    {% render_bundle 'main' 'js' %}

    {% block extra_js %}{% endblock %}

    {% include "includes/external_code.html" with place="footer" %}
    {% include "includes/cookie_consent.html" with privacy_policy_url=page.get_site.root_page.url|add:"privacy-policy/" %}
  </body>
</html>
